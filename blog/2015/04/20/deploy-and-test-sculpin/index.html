<!DOCTYPE html>
<html lang="en">
<head>
    <title>Testing and Deploying Sculpin to github pages on CircleCI | Blog of Michelle Krejci</title>
	<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Automate the deployment of your Sculpin project&#039;s artifact to Github Pages using CircleCI. Set it and forget it.">
<link rel="alternate" type="application/rss+xml" title="Blog of Michelle Krejci Feed" href="/rss.xml" />

<link href="/assets/css/bootstrap.css" rel="stylesheet" type="text/css" />
<link href="/assets/css/font-awesome.css" rel="stylesheet" type="text/css" />
<link href="/assets/css/pygments.css" rel="stylesheet" type="text/css" />
<link href="/assets/css/highlight/default.css" rel="stylesheet" type="text/css" />
<link href="/assets/css/style.css" rel="stylesheet" type="text/css" />

<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@dev_meshev">
<meta name="twitter:title" content="Testing and Deploying Sculpin to github pages on CircleCI">
<meta name="twitter:description" content="Automate the deployment of your Sculpin project&#039;s artifact to Github Pages using CircleCI. Set it and forget it.">
<meta name="twitter:creator" content="@dev_meshev">
<meta name="twitter:image:src" content="http://craychee.io/img/michelle.jpg">
<meta name="twitter:domain" content="craychee.io">

<meta property="og:type" content="blog">
<meta property="og:site_name" content="Blog of Michelle Krejci">
<meta property="og:url" content="/blog/2015/04/20/deploy-and-test-sculpin">
<meta property="og:title" content="Testing and Deploying Sculpin to github pages on CircleCI">
<meta property="og:image" content="http://craycheeio/img/michelle.jpg">
</head>
<body>
<nav class="navbar navbar-static-top navbar-inverse" role="navigation">
    <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="/">Home</a></li>
                <li><a href="/about-craychee/">About</a></li>
                <li><a href="mailto:michelle@craychee.io?Subject=Your blog"><img alt="Email Craychee" src="/img/icon_contact.png" /></a></li>
                <li><a href="http://twitter.com/dev_meshev"><img alt="Craychee's Twitter Account'" src="/img/icon_twitter.png" /></a></li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>


<article>

<div class="section blurred-lines">
    <div class="container">

        <div class="page-header">
        <h1 class="textfill"><span>Testing and Deploying Sculpin to github pages on CircleCI</span></h1>                </div>

    </div>
</div>

<div class="container">

<div class="entry-content">
<p>My setup here was adapted from <a href="http://wouterj.nl/2015/02/using-travis-to-build-your-sculpin-blog/">this excellent Wouter de Jong</a> post, which described automated deployment of sculpin using <code>travisci</code>, for <a href="https://circleci.com">Circleci</a> and testing with <a href="http://docs.behat.org/en/v3.0/">behat</a>. The original blog should absolutely be read first.</p>

<p>Here is what my <code>circle.yml</code> for deploying this sculpin blog looks like:</p>

<pre><code>machine:
  php:
    version: 5.5.11
  hosts:
    craychee.local: 127.0.0.1

dependencies:
  pre:
  - curl -O https://download.sculpin.io/sculpin.phar
  - php sculpin.phar install
  - cp circle.conf /etc/apache2/sites-available/default
  - sudo sed -e "s?%HOME%?$(pwd)?g" --in-place /etc/apache2/sites-available/default
  - sudo service apache2 restart
  post:
  - php sculpin.phar generate --env prod

test:
  override:
      - bin/behat -f pretty

deployment:
  production:
    branch: publish
    commands:
      - sh publish.sh
</code></pre>

<p>Once again, actually reading the <a href="https://circleci.com/docs/configuration">circleci documentation</a> will decrypt most of this for you, including variable names ("machine", "pre", "override", etc.).
This is what I am doing differently than Wonter de Jung suggests.</p>

<p><strong>I am installing sculpin from source rather than installing with <code>composer.json</code>.</strong></p>

<pre><code class="php"># circle.yml
...
    dependencies:
      pre:
      - curl -O https://download.sculpin.io/sculpin.phar
      - php sculpin.phar install
...
</code></pre>

<p>Installing with composer is probably more professional, at least it is more customizable, but I had no such need.</p>

<p><strong>I am pointing apache2 at my generated sculpin site.</strong></p>

<p>I am building the production directory <code>output_prod</code> and running acceptance tests on it, only deploying if they pass. In order to do this, I need to set up a server to serve up the site for behat to crawl.</p>

<pre><code class="php"># circle.yml
...
    dependencies:
      pre:
      ...
      - cp circle.conf /etc/apache2/sites-available/default
      - sudo sed -e "s?%HOME%?$(pwd)?g" --in-place /etc/apache2/sites-available/default
      - sudo service apache2 restart
...
</code></pre>

<p>Here is what my generic <code>circle.conf</code> looks like:</p>

<pre><code>&lt;VirtualHost *:80&gt;
    UseCanonicalName Off
    DocumentRoot %HOME%/output_prod

  &lt;Directory %HOME%/*&gt;
    Options FollowSymLinks
    AllowOverride None
    Order allow,deny
    Allow from all
  &lt;/Directory&gt;

&lt;/VirtualHost&gt;
</code></pre>

<p>The <code>%HOME%</code> variable was replaced inside the <code>circle.yml</code>:</p>

<pre><code class="php">      - sudo sed -e "s?%HOME%?$(pwd)?g" --in-place /etc/apache2/sites-available/default
</code></pre>

<p>With all that setup, <strong>I can execute my behat test suite</strong> and deploy to github pages if all is well. I took entirely Wonter's recommendation for my <code>publish.sh</code>, only omitting the build of the <code>output_prod</code> directory.</p>

<p>One last thing: I didn't need to set up a github token on <code>circleci</code> for deployment. This is either a feature of circleCI or a security breach on my part.</p>

</div>

</div><!-- .container -->

</article>

<div class="container">

<div class="entry-content">
<h3>What do you think?</h3>
<p>I'd love to hear from you. <a href="mailto:michelle@craychee.io?Subject=Your blog">Contact Michelle</a>.</p>
</div>

</div><!-- .container -->


<footer class="footer inverse">

<div class="container">
    <div class="row">
        <div class="col-xs-12 text-center"><small>Powered by <a href="https://sculpin.io/">Sculpin</a></small></div>
    </div>
</div>

</footer>

<script type="text/javascript">

var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-61998846-1']);
_gaq.push(['_trackPageview']);

(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

</script>

<!-- Placed at the end of the document so the pages load faster -->
<script src="/assets/js/augment.min.js"></script>
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/respond.min.js"></script>
<script src="/assets/js/jquery.textfill.min.js"></script>
<script src="/assets/js/highlight.pack.js"></script>
<script type="text/javascript">
hljs.initHighlightingOnLoad();
$(function(){
    resizeTextFill();
    $( window ).resize( resizeTextFill );
});
function resizeTextFill()
{
    $('.textfill').textfill({ maxFontPixels: 70, widthOnly: true });
}
</script>
</body>
</html>
